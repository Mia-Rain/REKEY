<body>
<a href="" id="a">Click to save AUTHKEYS</a>
<div id="authkey">
</div>
</body>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
function download(text, name, type) {
  var a = document.getElementById("a");
  var file = new Blob([text], {type: type});
  a.href = URL.createObjectURL(file);
  a.download = name;
}
var urlParams = new URLSearchParams(window.location.search);
console.log(urlParams.get('code'));
var code = urlParams.get('code');
const CLID = sessionStorage.getItem('CLID');
const CLSEC = sessionStorage.getItem('CLSEC');
$.ajax({
            type: 'POST',
            url: "https://accounts.spotify.com/api/token",
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            contentType: 'application/x-www-form-urlencoded; charset=utf-8',
            dataType: 'json',
            data: { 'client_id': CLID, 'client_secret': CLSEC, 'redirect_uri': 'http://www.thatgeekyweeb.is-dummy-thi.cc/REKEY/callback/', code, 'grant_type': "authorization_code" },
            success: function (response, data) {
                	console.log(response);
			console.log(data);
                	sessionStorage.setItem('refresh_token', response.refresh_token);
	    },
	    error: function () {
		     console.log("PLEASE GO TO https://www.thatgeekyweeb.is-dummy-thi.cc/REKEY/");
	    }
});
window.refresh_token = sessionStorage.getItem('refresh_token');
function auth(){
	$.ajax({
  	      type: 'POST',
    	      url: 'https://accounts.spotify.com/api/token',
      	      contentType: 'application/x-www-form-urlencoded',
              data: { 'client_id': sessionStorage.getItem('CLID'), 'client_secret': sessionStorage.getItem('CLSEC'), 'grant_type': 'refresh_token', 'refresh_token': window.refresh_token },
      	      success: function (response, data) {
			    sessionStorage.setItem('access_token', response.access_token);
    	      },
              error: function (xhr, ajaxOptions, thrownError) {
                console.log("PLEASE GO TO https://www.thatgeekyweeb.is-dummy-thi.cc/REKEY/");
              }
	});
	window.access_token = sessionStorage.getItem('access_token');
}
auth();
window.history.replaceState(null, null, window.location.pathname); // Emptys the URL params since there ugly
document.getElementById("authkey").innerText= 'REKEY=' + sessionStorage.getItem('refresh_token') + '\nCLID=' + CLID + '\nCLSEC' + CLSEC; 
download('REKEY=' + sessionStorage.getItem('refresh_token') + '\nCLID=' + CLID + '\nCLSEC=' + CLSEC, 'authkeys', 'text/plain')
</script>
